(()=>{'use strict';let a=document.querySelector('#autoplay'),b=document.querySelector('#media'),c=window.location.pathname.split('/').pop(),d=document.querySelectorAll('.transcription-part');document.addEventListener('DOMContentLoaded',()=>{let A=document.querySelector('#scrollToTop'),_=300;window.scrollY>_&&(A.style.display='block');window.addEventListener('scroll',()=>{window.scrollY>_?A.style.display='block':A.style.display='none'});A.addEventListener('click',B=>{B.preventDefault();window.scrollTo({top:0,behavior:'smooth'})})});for(const C of d)C.addEventListener('change',async _a=>{let _b=await i(`/api/transcriptions/${c}`,{field:_a.target.dataset.field, value:_a.target.value},'POST');_b.status===200?(C.classList.remove('error'),C.classList.add('success')):(C.classList.remove('success'),C.classList.add('error'))});let e=document.querySelectorAll('.segment');e.forEach(f);function f(D){let _B=D.dataset.index,_c=D.querySelectorAll('input'),_d=D.querySelectorAll('textarea'),E=D.querySelectorAll('button'),F=document.querySelector(`#start-${_B}`),G=D.querySelectorAll('[data-bs-toggle="tooltip"]'),H=[...G].map(_A=>new bootstrap.Tooltip(_A, {trigger:'hover'}));for(const aA of _c)aA.addEventListener('change',async aB=>{let aC={field:aB.target.dataset.field};aC.field==='start'||aC.field==='end'?aC['value']=j(aB.target.value):aC['value']=aB.target.value;let _C=await i(`/api/segments/${_B}`,aC,'POST');_C.status===200?(aA.classList.remove('error'),aA.classList.add('success')):(aA.classList.remove('success'),aA.classList.add('error'))});for(const aD of _d){aD.addEventListener('focus',()=>{if(a.checked){let aE=j(F.value);aE&&(b.currentTime=aE,b.play())}});aD.addEventListener('change',async aF=>{let aG=await i(`/api/segments/${_B}`,{field:aF.target.dataset.field, value:aF.target.value},'POST');aG.status===200?(aD.classList.remove('error'),aD.classList.add('success')):(aD.classList.remove('success'),aD.classList.add('error'))})}for(const aH of E){let aI=aH.dataset.type;if(!b)switch(aI) {case 'play':case 'pause':case 'rewind':aH.disabled=!0;break}aH.addEventListener('click',()=>{switch(aI) {case 'play':b.currentTime=j(F.value,!1);b.play();break;case 'pause':b.paused?b.play():b.pause();break;case 'rewind':let aJ=b.currentTime;let aK=aJ-1.0;b.currentTime=(aK<0)?0:aK;break;case 'add-before':g(_B,-1);break;case 'add-after':g(_B,1);break;case 'delete':h(_B);break;default:console.log('You should never see this.')}})}}async function g(aL,aM){let aN,_D=-1,_e=document.querySelector(`.segment[data-index='${aL}']`);if(aM<0)aN=_e.previousElementSibling;else if(aM>0)aN=_e.nextElementSibling;else{alert('Segment creation failed due to placement issue.');return}(aN&&aN.classList.contains('segment'))&&(_D=aN.dataset.index);let _f=await i('/api/segments/',{segmentId:aL, otherId:_D, where:aM},'POST');if(_f.status==200){let aO=await _f.json();let aP=document.createElement('div');aP.innerHTML=aO.segment.trim();let aQ=aP.childNodes[0];if(aM<0)_e.before(aQ);else aM>0&&_e.after(aQ);f(aQ)}else alert('Segment creation failed due to server error.')}async function h(aR){let aS;if(aR&&(aS=document.querySelector(`.segment[data-index='${aR}']`))){let aU=await i(`/api/segments/${aR}`,{method:'DELETE'},'POST');if(aU.status==204){let aV=bootstrap.Tooltip.getInstance(aS.querySelector('.segment-delete'));aV?.dispose();aS.remove()}else alert('Segment deletion failed due to server error.')}let aT=document.querySelectorAll('.segment');aT.length===0&&window.location.reload()}async function i(aW,aX,aY='GET'){let aZ={'Content-Type':'application/json','X-Requested-With':'XMLHttpRequest'};aY.toUpperCase()=='POST'&&(aZ['X-CSRFToken']=document.querySelector('[name=csrfmiddlewaretoken]').value);let _E=await fetch(aW,{method:aY.toUpperCase(),body:JSON.stringify(aX),headers:aZ,mode:'same-origin'});return _E}function j(bA,bB=!0){let bC=bA.split(':'),bD=0,bE=0,_F=0,_g=0,_h=bF=>{let bG=bF.split('.'),bI=0;bG[0]===''&&(bG[0]='0');let bH=parseInt(bG[0],10);if(bG.length>1){let bJ=bG[1];if(bJ.length===1)bI=parseInt(`${bJ}00`,10);else bJ.length===2?bI=parseInt(`${bJ}0`,10):bI=parseInt(bJ.substring(0,3),10)}return{seconds:bH,milliseconds:bI}};if(bC.length===1){const{seconds:s,milliseconds:bK}=_h(bC[0]);_F=s;_g=bK}else if(bC.length===2){bE=parseInt(bC[0],10);const{seconds:s,milliseconds:bL}=_h(bC[1]);_F=s;_g=bL}else if(bC.length===3){bD=parseInt(bC[0],10);bE=parseInt(bC[1],10);const{seconds:s,milliseconds:bM}=_h(bC[2]);_F=s;_g=bM}let I=(bD*3600)+(bE*60)+_F+(_g/1000);if(isNaN(I))return bB?null:0;return I}})();
